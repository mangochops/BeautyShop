(()=>{var e={};e.id=1020,e.ids=[1020],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},80072:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>j,routeModule:()=>y,serverHooks:()=>I,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{GET:()=>h,POST:()=>g});var n=r(42706),s=r(28203),i=r(45994),o=r(39187),u=r(11587),c=r(44512),d=r(55511);let p={randomUUID:d.randomUUID},l=new Uint8Array(256),m=l.length,f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));let w=function(e,t,r){if(p.randomUUID&&!t&&!e)return p.randomUUID();let a=(e=e||{}).random??e.rng?.()??(m>l.length-16&&((0,d.randomFillSync)(l),m=0),l.slice(m,m+=16));if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}(a)};async function x(){let e=(0,c.cookies)(),t=e.get("cartId")?.value;return t?await u.z.cart.findUnique({where:{sessionId:t}})||await u.z.cart.create({data:{id:t,sessionId:t}}):(t=w(),e.set("cartId",t,{httpOnly:!0,secure:!0,maxAge:2592e3,path:"/"}),await u.z.cart.create({data:{id:t,sessionId:t}})),t}async function h(){try{let e=await x(),t=await u.z.cart.findUnique({where:{sessionId:e},include:{items:{include:{product:{include:{images:{where:{isMain:!0},take:1}}}}}}});if(!t)return o.NextResponse.json({items:[],subtotal:0});let r=t.items.reduce((e,t)=>e+t.product.price*t.quantity,0);return o.NextResponse.json({items:t.items.map(e=>({id:e.id,productId:e.productId,name:e.product.name,price:e.product.price,quantity:e.quantity,variant:e.variant,image:e.product.images[0]?.url||null})),subtotal:r})}catch(e){return console.error("Error fetching cart:",e),o.NextResponse.json({error:"Failed to fetch cart"},{status:500})}}async function g(e){try{let{productId:t,quantity:r,variant:a}=await e.json();if(!t||!r)return o.NextResponse.json({error:"Product ID and quantity are required"},{status:400});let n=await u.z.product.findUnique({where:{id:t}});if(!n)return o.NextResponse.json({error:"Product not found"},{status:404});if(!n.inStock)return o.NextResponse.json({error:"Product is out of stock"},{status:400});let s=await x(),i=await u.z.cartItem.findFirst({where:{cartId:s,productId:t,variant:a||null}});if(i){let e=await u.z.cartItem.update({where:{id:i.id},data:{quantity:i.quantity+r}});return o.NextResponse.json(e)}{let e=await u.z.cartItem.create({data:{cartId:s,productId:t,quantity:r,variant:a||null}});return o.NextResponse.json(e)}}catch(e){return console.error("Error adding item to cart:",e),o.NextResponse.json({error:"Failed to add item to cart"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"/workspaces/BeautyShop/app/api/cart/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:q,workUnitAsyncStorage:v,serverHooks:I}=y;function j(){return(0,i.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:v})}},96487:()=>{},78335:()=>{},11587:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var a=r(96330);let n=global.prisma||new a.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,5452,4512],()=>r(80072));module.exports=a})();