(()=>{var e={};e.id=3146,e.ids=[3146],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},62396:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>c,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{GET:()=>u});var i=t(42706),a=t(28203),n=t(45994),o=t(39187),p=t(11587);async function u(e){let{searchParams:r}=new URL(e.url),t=Number.parseInt(r.get("page")||"1"),s=Number.parseInt(r.get("limit")||"12"),i=r.get("category")||"",a=r.get("search")||"",n=r.get("sort")||"createdAt:desc",u=Number.parseInt(r.get("minPrice")||"0"),c=Number.parseInt(r.get("maxPrice")||"1000000"),d="true"===r.get("featured"),[l,g]=n.split(":"),m=(t-1)*s,v={inStock:!0,price:{gte:u,lte:c},...i?{category:{slug:i}}:{},...d?{featured:!0}:{},...a?{OR:[{name:{contains:a,mode:"insensitive"}},{description:{contains:a,mode:"insensitive"}}]}:{}};try{let[e,r]=await Promise.all([p.prisma.product.findMany({where:v,include:{category:{select:{id:!0,name:!0,slug:!0}},images:{where:{isMain:!0},take:1},reviews:{select:{rating:!0}}},orderBy:{[l]:"asc"===g.toLowerCase()?"asc":"desc"},skip:m,take:s}),p.prisma.product.count({where:v})]),i=e.map(e=>{let r=e.reviews.reduce((e,r)=>e+r.rating,0),t=e.reviews.length>0?r/e.reviews.length:0,s=e.reviews.length;return{...e,rating:t,reviews:s}});return o.NextResponse.json({products:i,meta:{total:r,page:t,limit:s,totalPages:Math.ceil(r/s)}})}catch(e){return console.error("Error fetching products:",e),o.NextResponse.json({error:"Failed to fetch products"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/workspaces/BeautyShop/app/api/products/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:g}=c;function m(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},96487:()=>{},78335:()=>{},11587:(e,r,t)=>{"use strict";var s=t(96330),i=t(12042),a=t(23420);let n=global;if(process.env.VERCEL){let e=new i.bC({connectionString:process.env.DATABASE_URL}),r=new a.J(e);new s.PrismaClient({adapter:r,log:["error"]})}else n.prisma||new s.PrismaClient({log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,3420,5452],()=>t(62396));module.exports=s})();